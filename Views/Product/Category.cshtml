@model fleurDamour.Models.Category
@{
    ViewData["Title"] = "Category";
    FleurDamourContext db = new();
    var allProducts = db.Products
        .Where(p => p.Idcategories.Any(c => c.Idcategory == Model.Idcategory))
        .ToList();

    var productCategory = allProducts.Take(9).ToList();
    var picCategory = db.Categories.SingleOrDefault(c => c.Idcategory == Model.Idcategory)?.PicCategory;
}

<style>

    
    .events-area{
        background-color: black;
    }
    .event-thumbnail {
        width: 100%; /* Định chiều rộng cố định */
        height: 400px; /* Định chiều cao cố định */
        overflow: hidden; /* Đảm bảo không bị tràn */
        display: flex;
        justify-content: center;
        align-items: center;
    }

        .event-thumbnail img {
            width: 100%;
            height: 100%;
            object-fit: cover; /* Giữ tỷ lệ ảnh, cắt phần dư */
            border-top-left-radius: 10px; /* Bo góc nếu cần */
            border-top-right-radius: 10px;
        }

</style>

<!-- ##### Breadcumb Area Start ##### -->
<section class="breadcumb-area bg-img bg-overlay" style="background-image: url('@Url.Content("~/"+ picCategory)');">
    <div class="container h-100">
        <div class="row h-100 align-items-center">
            <div class="col-12">
                <div class="breadcumb-text text-center">
                    <h1 style="color: white">@Model.NameCategory</h1>
                </div>
            </div>
        </div>
    </div> 
</section>
<!-- ##### Breadcumb Area End ##### -->
<!-- ##### Events Area Start ##### -->
<section class="events-area section-padding-100">
    <div class="container">
        <div class="row" id="productContainer">
            @foreach (var item in productCategory)
            {
                <div class="col-12 col-md-6 col-lg-4 product-item">
                    <div class="single-event-area mb-30">
                        <div class="event-thumbnail">
                            <img src="@item.ImgProduct" alt="@item.NameProduct" />
                        </div>
                        <div class="event-text" style="border: 1px solid white">
                            <h4>@item.NameProduct</h4>
                            <div class="event-meta-data">
                                <a href="#" class="event-place">Price: @item.Price vnd</a>
                                <a href="#" class="event-date">Quantity: @item.Quantity</a>
                            </div>
                            <a asp-action="Product" asp-controller="Product" asp-route-id="@item.Idproduct" class="btn see-more-btn">See Product</a>
                        </div>
                    </div>
                </div>
            }
        </div>
        <div class="row">
            <div class="col-12">
                <div class="load-more-btn text-center mt-70">
                    <a id="loadMore" class="btn oneMusic-btn">Load More <i class="fa fa-angle-double-right"></i></a>
                </div>
            </div>
        </div>
    </div>
</section>
<!-- ##### Events Area End ##### -->
@* <!-- ##### Newsletter & Testimonials Area Start ##### -->
<section class="newsletter-testimonials-area">
    <div class="container">
        <div class="row">

            <!-- Newsletter Area -->
            <div class="col-12 col-lg-6">
                <div class="newsletter-area mb-100">
                    <div class="section-heading text-left mb-50">
                        <p>See what’s new</p>
                        <h2>Subscribe to newsletter</h2>
                    </div>
                    <div class="newsletter-form">
                        <form action="#">
                            <input type="search" name="search" id="newsletterSearch" placeholder="E-mail">
                            <button type="submit" class="btn oneMusic-btn">Subscribe <i class="fa fa-angle-double-right"></i></button>
                        </form>
                    </div>
                </div>
            </div>

            <!-- Testimonials Area -->
            <div class="col-12 col-lg-6">
                <div class="testimonials-area mb-100 bg-img bg-overlay" style="background-image: url(img/bg-img/bg-3.jpg);">
                    <div class="section-heading white text-left mb-50">
                        <p>See what’s new</p>
                        <h2>Testimonial</h2>
                    </div>
                    <!-- Testimonial Slide -->
                    <div class="testimonials-slide owl-carousel">
                        <!-- Single Slide -->
                        <div class="single-slide">
                            <p>Nam tristique ex vel magna tincidunt, ut porta nisl finibus. Vivamus eu dolor eu quam varius rutrum. Fusce nec justo id sem aliquam fringilla nec non lacus. Suspendisse eget lobortis nisi, ac cursus odio. Vivamus nibh velit, rutrum.</p>
                            <div class="testimonial-info d-flex align-items-center">
                                <div class="testimonial-thumb">
                                    <img src="img/bg-img/t1.jpg" alt="">
                                </div>
                                <p>William Smith, Customer</p>
                            </div>
                        </div>
                        <!-- Single Slide -->
                        <div class="single-slide">
                            <p>Nam tristique ex vel magna tincidunt, ut porta nisl finibus. Vivamus eu dolor eu quam varius rutrum. Fusce nec justo id sem aliquam fringilla nec non lacus. Suspendisse eget lobortis nisi, ac cursus odio. Vivamus nibh velit, rutrum.</p>
                            <div class="testimonial-info d-flex align-items-center">
                                <div class="testimonial-thumb">
                                    <img src="img/bg-img/t1.jpg" alt="">
                                </div>
                                <p>Nazrul Islam, Developer</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>
</section>
<!-- ##### Newsletter & Testimonials Area End ##### --> *@
<script>
    document.addEventListener("DOMContentLoaded", function () {
        let products = @Html.Raw(System.Text.Json.JsonSerializer.Serialize(allProducts));
        let currentIndex = 9; // Bắt đầu từ sản phẩm thứ 9
        let productsPerPage = 9; // Mỗi lần load thêm 9 sản phẩm

        document.getElementById("loadMore").addEventListener("click", function () {
            let productContainer = document.getElementById("productContainer");

            for (let i = currentIndex; i < currentIndex + productsPerPage && i < products.length; i++) {
                let item = products[i];

                let productHtml = `
                            <div class="col-12 col-md-6 col-lg-4 product-item">
                                    <div class="single-event-area mb-30">
                                        <div class="event-thumbnail">
                                            <img src="${item.ImgProduct}" alt="${item.NameProduct}" />
                                        </div>
                                        <div class="event-text">
                                                <h4>${item.NameProduct}</h4>
                                                <div class="event-meta-data">
                                                           <a href="#" class="event-place">Price: ${item.Price} vnd</a>
                                                        <a href="#" class="event-date">Quantity: ${item.Quantity}</a>
                                                </div>
                                                    <a asp-action="Product" asp-controller="Product" asp-route-id="${item.Idproduct}" class="btn see-more-btn">See Product</a>
                                                </div>
                                        </div>
                                    </div>`;

                productContainer.insertAdjacentHTML("beforeend", productHtml);
            }

            currentIndex += productsPerPage;

            // Ẩn nút Load More nếu không còn sản phẩm
            if (currentIndex >= products.length) {
                document.getElementById("loadMore").style.display = "none";
            }
        });
    });
</script>
